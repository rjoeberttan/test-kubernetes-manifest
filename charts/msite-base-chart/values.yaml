# Default values for msite-base-chart.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.
# =================================================================
# Helm Generated Keys in values
# =================================================================
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext: {}
  # fsGroup: 2000

securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

# ================================================================
# Deployment Values
# ================================================================
# applicationName is being used as general naming for all Kubernetes Objects to be created
applicationName: player-portal-custom-components
namespace: msite-base-chart

# labels is being used for all labels in deployment, container, and being used as a selector in the service
labels: {
  "app.s3dv.io.name": "m88-player-portal-custom-components-homepage"
}

# Replica count in deployment 
replicaCount: 2

image:
  repository: yauritux/busybox-curl
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: "26"

imagePullSecrets: [{"name": "acr-secret"}]

# While these will be the ports to be exposed in the deployment/container
containerPorts: [{
    "containerPort": 3003,
    "name": "http",
    "protocol": TCP
  },{
    "containerPort": 443,
    "name": "https",
    "protocol": TCP 
  }]

# Environment variable in the deployment/container
envVars: [{"name": "NEW_RELIC_API_KEY", "value": "NRAK-95F7020N5N6374H377V9IPTCEHO"}]

applyStartupProbe: true
startupProbe: {
  "httpGet": {
    "path": "/api/health",
    "port": 8080
  },
  "failureThreshold": 30,
  "periodSeconds": 10
}


applyReadinessProbe: true
readinessProbe: {
  "failureThreshold": 5, 
  "httpGet": {
    "path": "/api/health",
    "port": "8080"
  },
  "initialDelaySeconds": 120,
  "periodSeconds": 10,
  "successThreshold": 1,
  "timeoutSeconds": 60
}

applyLivelinessProbe: true
livelinessProbe: {
  "failureThreshold": 5, 
  "httpGet": {
    "path": "/api/health",
    "port": "8080"
  },
  "initialDelaySeconds": 120,
  "periodSeconds": 10,
  "successThreshold": 1,
  "timeoutSeconds": 60,
  "terminationGracePeriodSeconds": 60
}

# Resources used for deployment/container
resources: {
  "requests": {"memory": "300Mi", "cpu": "100m"} , "limits": {"memory": "600Mi", "cpu": "300m"} 
}

# Tolerations used for deployment/container
tolerations: [
  {
    "key": "worker", "operator": "Equal", "value": "md-88", "effect": "NoSchedule"
  }
]

affinity: {
  "nodeAffinity": 
    {"requiredDuringSchedulingIgnoredDuringExecution":
      {"nodeSelectorTerms": 
        [
          {
            "matchExpressions": 
            [
              {"key": "nodepool", "operator": "In", "values": [ "mdm88pool01" ]}
            ]
          }        
        ]
      }
    }
}

applyVolumes: false
volumeMounts: [{"name": "config-appsettings-secret", "mountPath": "/app/appsettings.json", "subPath": "appsettings.json"}]
volumes: [{ "name": "config-appsettings-secret", "secret": {"secretName": "msite-player-portal-configuration-service-secret" }}]

applyDeploymentStrategy: 
  enabled: true
strategy: {"rollingUpdate": {"maxSurge": 1, "maxUnavailable": 1}, "type": "RollingUpdate"}



# ================================================================
# Service Values
# ================================================================
# This is the entries which will be populated in the service object
servicePorts: [{
    "port": 3003,
    "name": "http",
    "protocol": TCP,
    "targetPort": 3003,
  },{
    "port": 443,
    "name": "https",
    "protocol": TCP,
    "targetPort": 443,
  }]



# ================================================================
# Ingress Values
# ================================================================
ingress:
  enabled: true
  className: ""
  annotations: {
    "kubernetes.io/ingress.class": "nginx",
    "nginx.ingress.kubernetes.io/use-regex": "true",
    "nginx.ingress.kubernetes.io/proxy-cookie-path": "/ \"/; Secure;\""
    }
  hosts:
    - host: customcomponent.msite88.com
      paths:
        - path: /
          pathType: Prefix
          backend:
              service:
                name: m88-player-portal-custom-components
                port:
                  number: 3003
    - host: customcomponent2.msite88.com
      paths:
        - path: /
          pathType: Prefix
          backend:
              service:
                name: m88-player-portal-custom-components
                port:
                  number: 3003
  tls: []
  #  - secretName: chart-example-tls
  #    hosts:
  #      - chart-example.local
service:
  port: 3003


# ================================================================
# HPA Values
# ================================================================
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 4
  targetCPUUtilizationPercentage: 60
  targetMemoryUtilizationPercentage: 60

scaleDown: {
    "stabilizationWindowSeconds": 60,
    "policies": [{
      "type": "Pods", "value": 1, "periodSeconds": 60
    }]
  }

scaleUp: {
    "stabilizationWindowSeconds": 60,
    "policies": [{
      "type": "Pods", "value": 1, "periodSeconds": 60
    }]
  }

nodeSelector: {}


# ================================================================
# Configmap Values
# ================================================================
configFileName: appsettings.json
config: |
  {
    "APP_MSITE_CUSTOM_COMPONENT_URL":"https://customcomponent.msite88.com/_next/",
    "APP_MSITE_GATEWAY_URL": "https://api-gateway.msite88.com/api",
    "APP_MSITE_GATEWAY_KEY":"ca4073a2-049b-4e6b-bb3f-ec47bddfaf1d",
    "APP_MSITE_HUB_URL": "",
    "APP_MSITE_CONTENT_URL": "https://api-content.msite88.com/api",
    "APP_MSITE_CONTENT_KEY": "64e8e313-2f15-4b84-b301-bcd55a51f8ca",
    "APP_MSITE_KEY": "E9AA4960-F954-43D0-A80F-9FC949B2E169",
    "APP_MSITE_CDN_URL": "https://cdn.msite88.com/msite88/m88/Images",
    "APP_MSITE_IMAGE_DOMAINS": "cdn.msite88.com",
    "APP_MSITE_EXCHANGE_CHANNEL" : "1",
    "APP_MSITE_DEFAULT_DOMAIN" : "www.msite88.com",
    "APP_MSITE_CONTENT_INTERNAL_URL":"http://api-content.msite88.internal/api",
    "APP_MSITE_MFEEDS_URL": "https://api.mfeedbo.com/api",
    "APP_MSITE_MFEEDS_API_KEY": "qyvpHLcynLwpM02TjsYmpgVk2qogg8PU",
    "API_MSITE_GAME_IFRAME_DOMAIN": "https://www.m88.com",
    "APP_MSITE_STATIC_CONTENT_URL":"https://msite88.com/api/content",
    "APP_MSITE_STATIC_CONTENT_STORAGE":"cloud"
  }